<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>java-redis 学习 | 甜筒的微笑</title>

  <!-- keywords -->
  
    <meta name="keywords" content="java">
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="redis是什么Redis is an open source, BSD licensed, advanced key-value store. It is often referred to as a data structure server since keys can contain strings, hashes, lists, sets and sorted sets. redis是开">
<meta name="keywords" content="java">
<meta property="og:type" content="article">
<meta property="og:title" content="redis 学习">
<meta property="og:url" content="https://dayu007.github.io/2018/12/27/redis-学习/index.html">
<meta property="og:site_name" content="甜筒的微笑">
<meta property="og:description" content="redis是什么Redis is an open source, BSD licensed, advanced key-value store. It is often referred to as a data structure server since keys can contain strings, hashes, lists, sets and sorted sets. redis是开">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-12-27T08:40:48.105Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis 学习">
<meta name="twitter:description" content="redis是什么Redis is an open source, BSD licensed, advanced key-value store. It is often referred to as a data structure server since keys can contain strings, hashes, lists, sets and sorted sets. redis是开">
  
    <link rel="alternative" href="/atom.xml" title="甜筒的微笑" type="application/atom+xml">
  
  
    <link rel="icon" href="https://liuyiyi.site/head.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head></html>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://liuyiyi.site/head.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">dayu007</a></h1>
		</hgroup>

		
		<p class="header-subtitle">努力的人更加快乐</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">dayu007</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://liuyiyi.site/head.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">dayu007</h1>
			</hgroup>
			
			<p class="header-subtitle">努力的人更加快乐</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-redis-学习" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/12/27/redis-学习/" class="article-date">
  	<time datetime="2018-12-27T07:46:20.000Z" itemprop="datePublished">2018-12-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      redis 学习
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="redis是什么"><a href="#redis是什么" class="headerlink" title="redis是什么"></a>redis是什么</h2><pre><code>Redis is an open source, BSD licensed, advanced key-value store. It is often referred to as a data structure server since keys can contain strings, hashes, lists, sets and sorted sets.
</code></pre><p>redis是开源,BSD许可,高级的key-value存储系统.<br>可以用来存储字符串,哈希结构,链表,集合,因此,常用来提供数据结构服务.</p>
<h3 id="redis和memcached相比-的独特之处"><a href="#redis和memcached相比-的独特之处" class="headerlink" title="redis和memcached相比,的独特之处"></a>redis和memcached相比,的独特之处</h3><p>1: redis可以用来做存储(storge), 而memccached是用来做缓存(cache)<br>  这个特点主要因为其有”持久化”的功能.</p>
<p>2: 存储的数据有”结构”,对于memcached来说,存储的数据,只有1种类型–”字符串”,而redis则可以存储字符串,链表,哈希结构,集合,有序集合.</p>
<h3 id="Redis下载安装"><a href="#Redis下载安装" class="headerlink" title="Redis下载安装"></a>Redis下载安装</h3><ol>
<li>官方站点: redis.io 下载最新版或者最新stable版</li>
<li>解压源码并进入目录</li>
<li>不用configure</li>
<li>直接make<br>(如果是32位机器 make 32bit)</li>
</ol>
<p>注:易碰到的问题,时间错误.<br>原因: 源码是官方configure过的,但官方configure时,生成的文件有时间戳信息,<br>Make只能发生在configure之后,<br>如果你的虚拟机的时间不对,比如说是2012年<br>解决: date -s ‘yyyy-mm-dd hh:mm:ss’   重写时间<br>    再 clock -w  写入cmos</p>
<ol start="5">
<li><p>可选步骤: make test  测试编译情况<br>(可能出现: need tcl  &gt;8.4这种情况, yum install tcl)</p>
</li>
<li><p>安装到指定的目录,比如<br><code>/usr/local/redis</code><br><code>make  PREFIX=/usr/local/redis install</code><br><strong>注: PREFIX要大写</strong></p>
</li>
</ol>
<p>7: <code>make install</code>之后,得到如下几个文件</p>
<pre><code>redis-benchmark  性能测试工具
redis-check-aof  日志文件检测工(比如断电造成日志损坏,可以检测并修复)
redis-check-dump  快照文件检测工具,效果类上
redis-cli  客户端
redis-server 服务端
</code></pre><p>8: 复制配置文件<br>Cp /path/redis.conf /usr/local/redis</p>
<p>9: 启动与连接<br>/path/to/redis/bin/redis-server  ./path/to/conf-file<br>例:[root@localhost redis]# ./bin/redis-server ./redis.conf </p>
<p>连接: 用redis-cli</p>
<p>#/path/to/redis/bin/redis-cli [-h localhost -p 6379 ]</p>
<p>10: 让redis以后台进程的形式运行<br>编辑conf配置文件,修改如下内容;<br>daemonize yes</p>
<h2 id="Redis对于key的操作命令"><a href="#Redis对于key的操作命令" class="headerlink" title="Redis对于key的操作命令"></a>Redis对于key的操作命令</h2><pre><code>del key1 key2 ... Keyn
</code></pre><p>作用: 删除1个或多个键<br>返回值: 不存在的key忽略掉,返回真正删除的key的数量</p>
<pre><code>rename key newkey
</code></pre><p>作用: 给key赋一个新的key名<br>注:如果newkey已存在,则newkey的原值被覆盖</p>
<pre><code>renamenx key newkey  
</code></pre><p>作用: 把key改名为newkey<br>返回: 发生修改返回1,未发生修改返回0<br>注: nx–&gt; not exists, 即, newkey不存在时,作改名动作</p>
<pre><code>move key db
redis 127.0.0.1:6379[1]&gt; select 2
OK
redis 127.0.0.1:6379[2]&gt; keys *
(empty list or set)
redis 127.0.0.1:6379[2]&gt; select 0
OK
redis 127.0.0.1:6379&gt; keys *
1) &quot;name&quot;
2) &quot;cc&quot;
3) &quot;a&quot;
4) &quot;b&quot;
redis 127.0.0.1:6379&gt; move cc 2
(integer) 1
redis 127.0.0.1:6379&gt; select 2
OK
redis 127.0.0.1:6379[2]&gt; keys *
1) &quot;cc&quot;
redis 127.0.0.1:6379[2]&gt; get cc
&quot;3&quot;
</code></pre><p><em>(注意: 一个redis进程,打开了不止一个数据库, 默认打开16个数据库,从0到15编号,<br>如果想打开更多数据库,可以从配置文件修改)</em></p>
<ul>
<li><code>keys pattern</code> 查询相应的key</li>
</ul>
<p>在redis里,允许模糊查询key<br>有3个通配符 <code>*, ? ,[]</code><br>*: 通配任意多个字符<br>?: 通配单个字符<br>[]: 通配括号内的某1个字符</p>
<figure class="highlight plain"><figcaption><span>127.0.0.1:6379> flushdb</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or set)</span><br><span class="line">redis 127.0.0.1:6379&gt; mset one 1 two 2 three 3 four 4</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; keys o*</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; key *o</span><br><span class="line">(error) ERR unknown command &apos;key&apos;</span><br><span class="line">redis 127.0.0.1:6379&gt; keys *o</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; keys ???</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; keys on?</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; set ons yes</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; keys on[eaw]</span><br><span class="line">1) &quot;one&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>randomkey 返回随机key</p>
</li>
<li><p>exists key<br>判断key是否存在,返回1/0</p>
</li>
</ul>
<ul>
<li>type key<br>返回key存储的值的类型<br>有<strong><em>string,link,set,order set, hash</em></strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- ttl key  </span><br><span class="line">作用: 查询key的生命周期</span><br><span class="line">返回: 秒数</span><br><span class="line"></span><br><span class="line">** 注:对于不存在的key或已过期的key/不过期的key,都返回-1</span><br><span class="line">Redis2.8中,对于不存在的key,返回-2 ** </span><br><span class="line"></span><br><span class="line">+ expire key 整型值  </span><br><span class="line">作用: 设置key的生命周期,以秒为单位</span><br><span class="line"></span><br><span class="line">+ 同理: </span><br><span class="line">`pexpire key` 毫秒数, 设置生命周期</span><br><span class="line">`pttl  key` 以毫秒返回生命周期</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ persist key  </span><br><span class="line">作用: 把指定key置为永久有效</span><br><span class="line"> </span><br><span class="line">### Redis字符串类型的操作</span><br><span class="line"></span><br><span class="line">+ set key value [ex 秒数] / [px 毫秒数]  [nx] /[xx]   </span><br><span class="line">如: set a 1 ex 10 , 10秒有效</span><br><span class="line">Set a 1 px 9000  , 9秒有效</span><br><span class="line">注: 如果ex,px同时写,以后面的有效期为准</span><br><span class="line">如 set a 1 ex 100 px 9000, 实际有效期是9000毫秒</span><br><span class="line"></span><br><span class="line">+ nx: 表示key不存在时,执行操作</span><br><span class="line">+ xx: 表示key存在时,执行操作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ mset  multi set , 一次性设置多个键值   </span><br><span class="line">例: mset key1 v1 key2 v2 ....</span><br><span class="line"></span><br><span class="line">+ get key  </span><br><span class="line">作用:获取key的值</span><br><span class="line"></span><br><span class="line">+ mget key1 key2 ..keyn   </span><br><span class="line">作用:获取多个key的值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ setrange key offset value   </span><br><span class="line">作用:把字符串的offset偏移字节,改成value</span><br><span class="line">      redis 127.0.0.1:6379&gt; set greet hello</span><br><span class="line">      OK</span><br><span class="line">      redis 127.0.0.1:6379&gt; setrange greet 2 x</span><br><span class="line">      (integer) 5</span><br><span class="line">      redis 127.0.0.1:6379&gt; get greet</span><br><span class="line">      &quot;hexlo&quot;</span><br><span class="line"></span><br><span class="line">**注意: 如果偏移量&gt;字符长度, 该字符自动补0x00**  </span><br><span class="line"></span><br><span class="line">`redis 127.0.0.1:6379&gt; setrange greet 6 !</span><br><span class="line">(integer) 7</span><br><span class="line">redis 127.0.0.1:6379&gt; get greet</span><br><span class="line">&quot;heyyo\x00!&quot;`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ append key value      </span><br><span class="line">作用: 把value追加到key的原值上</span><br><span class="line"></span><br><span class="line">- getrange key start stop   </span><br><span class="line">作用: 是获取字符串中 [start, stop]范围的值</span><br><span class="line">注意: 对于字符串的下标,左数从0开始,右数从-1开始</span><br><span class="line">`redis 127.0.0.1:6379&gt; set title &apos;chinese&apos;</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; getrange title 0 3</span><br><span class="line">&quot;chin&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; getrange title 1 -2</span><br><span class="line">&quot;hines&quot;`</span><br><span class="line"></span><br><span class="line">	**注意: **   </span><br><span class="line">1: start&gt;=length, 则返回空字符串  </span><br><span class="line">2: stop&gt;=length,则截取至字符结尾   </span><br><span class="line">3: 如果start 所处位置在stop右边, 返回空字符串</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- getset key newvalue    </span><br><span class="line">作用: 获取并返回旧值,设置新值</span><br><span class="line">`redis 127.0.0.1:6379&gt; set cnt 0</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; getset cnt 1</span><br><span class="line">&quot;0&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; getset cnt 2</span><br><span class="line">&quot;1&quot;`</span><br><span class="line"></span><br><span class="line">- incr key      </span><br><span class="line">作用: 指定的key的值加1,并返回加1后的值</span><br><span class="line"></span><br><span class="line">	**注意:**  </span><br><span class="line">1:不存在的key当成0,再incr操作   </span><br><span class="line">2: 范围为64有符号    </span><br><span class="line"></span><br><span class="line">`incrby key number</span><br><span class="line">redis 127.0.0.1:6379&gt; incrby age  90</span><br><span class="line">(integer) 92</span><br><span class="line"></span><br><span class="line">incrbyfloat key floatnumber</span><br><span class="line">redis 127.0.0.1:6379&gt; incrbyfloat age 3.5</span><br><span class="line">&quot;95.5&quot;</span><br><span class="line"></span><br><span class="line">decr key</span><br><span class="line">redis 127.0.0.1:6379&gt; set age 20</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; decr age</span><br><span class="line">(integer) 19</span><br><span class="line"></span><br><span class="line">decrby key number</span><br><span class="line">redis 127.0.0.1:6379&gt; decrby age 3</span><br><span class="line">(integer) 16`</span><br><span class="line"></span><br><span class="line">- getbit key offset     </span><br><span class="line">作用:获取值的二进制表示,对应位上的值(从左,从0编号)</span><br><span class="line">`redis 127.0.0.1:6379&gt; set char A</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; getbit char 1</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; getbit char 2</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; getbit char 7</span><br><span class="line">(integer) 1`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- setbit  key offset value    </span><br><span class="line">设置offset对应二进制位上的值   </span><br><span class="line">返回: 该位上的旧值</span><br><span class="line"></span><br><span class="line">	**注意: **   </span><br><span class="line">1:如果offset过大,则会在中间填充0,   </span><br><span class="line">2: offset最大大到多少   </span><br><span class="line">3:offset最大2^32-1,可推出最大的的字符串为512M   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+  bitop operation destkey key1 [key2 ...]   </span><br><span class="line">对key1,key2..keyN作operation,并将结果保存到 destkey 上。   </span><br><span class="line">	operation 可以是 AND 、 OR 、 NOT 、 XOR</span><br><span class="line"></span><br><span class="line">`redis 127.0.0.1:6379&gt; setbit lower 7 0</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit lower 2 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; get lower</span><br><span class="line">&quot; &quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; set char Q</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; get char</span><br><span class="line">&quot;Q&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; bitop or char char lower</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; get char</span><br><span class="line">&quot;q&quot;`</span><br><span class="line"></span><br><span class="line">注意: 对于NOT操作, key不能多个</span><br><span class="line"> </span><br><span class="line">### link 链表结构</span><br><span class="line"></span><br><span class="line">- lpush key value   </span><br><span class="line">作用: 把值插入到链接头部</span><br><span class="line">- rpop key  </span><br><span class="line">作用: 返回并删除链表尾元素</span><br><span class="line">- rpush,lpop: 不解释</span><br><span class="line">- lrange key start  stop  </span><br><span class="line">作用: 返回链表中[start ,stop]中的元素  </span><br><span class="line">规律: 左数从0开始,右数从-1开始</span><br><span class="line"></span><br><span class="line">- lrem key count value  </span><br><span class="line">作用: 从key链表中删除 value值  </span><br><span class="line">注: 删除count的绝对值个value后结束</span><br><span class="line">Count&gt;0 从表头删除</span><br><span class="line">Count&lt;0 从表尾删除</span><br><span class="line"></span><br><span class="line">- ltrim key start stop   </span><br><span class="line">作用: 剪切key对应的链接,切[start,stop]一段,并把该段重新赋给key</span><br><span class="line"></span><br><span class="line">- lindex key index    </span><br><span class="line">作用: 返回index索引上的值,</span><br><span class="line">如  lindex key 2</span><br><span class="line"></span><br><span class="line">- llen key  </span><br><span class="line">作用:计算链接表的元素个数</span><br><span class="line">redis 127.0.0.1:6379&gt; llen task</span><br><span class="line">(integer) 3</span><br><span class="line">redis 127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line">- linsert  key after|before search value   </span><br><span class="line">作用: 在key链表中寻找’search’,并在search值之前|之后,.插入value</span><br><span class="line">注: 一旦找到一个search后,命令就结束了,因此不会插入多个value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- rpoplpush source dest   </span><br><span class="line">作用: 把source的尾部拿出,放在dest的头部,</span><br><span class="line">并返回 该单元值  </span><br><span class="line">场景: task + bak 双链表完成安全队列</span><br><span class="line">Task列表   bak列表  </span><br><span class="line">业务逻辑:   </span><br><span class="line">1:Rpoplpush task bak  </span><br><span class="line">2:接收返回值,并做业务处理  </span><br><span class="line">3:如果成功,rpop bak 清除任务. 如不成功,下次从bak表里取任务  </span><br><span class="line"></span><br><span class="line">- brpop ,blpop  key timeout  </span><br><span class="line">作用:等待弹出key的尾/头元素,   </span><br><span class="line">Timeout为等待超时时间  </span><br><span class="line">如果timeout为0,则一直等待  </span><br><span class="line">场景: 长轮询Ajax,在线聊天时,能够用到</span><br><span class="line"> </span><br><span class="line">- Setbit 的实际应用  </span><br><span class="line">场景: 1亿个用户, 每个用户 登陆/做任意操作  ,记为 今天活跃,否则记为不活跃  </span><br><span class="line">每周评出: 有奖活跃用户: 连续7天活动</span><br><span class="line">每月评,等等...  </span><br><span class="line">思路: </span><br><span class="line">      Userid   dt  active</span><br><span class="line">      1        2013-07-27  1</span><br><span class="line">      1       2013-0726   1</span><br><span class="line"></span><br><span class="line">如果是放在表中, 1:表急剧增大,2:要用group ,sum运算,计算较慢   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">用: 位图法 bit-map   </span><br><span class="line">Log0721:  ‘011001...............0’  </span><br><span class="line"></span><br><span class="line">......   </span><br><span class="line">log0726 :   ‘011001...............0’   </span><br><span class="line">Log0727 :  ‘0110000.............1’   </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">1: 记录用户登陆:    </span><br><span class="line">每天按日期生成一个位图, 用户登陆后,把user_id位上的bit值置为1   </span><br><span class="line"> </span><br><span class="line">2: 把1周的位图  and 计算,    </span><br><span class="line">位上为1的,即是连续登陆的用户   </span><br><span class="line"></span><br><span class="line">`</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit mon 100000000 0</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit mon 3 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit mon 5 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit mon 7 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit thur 100000000 0</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit thur 3 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit thur 5 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit thur 8 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit wen 100000000 0</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit wen 3 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit wen 4 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; setbit wen 6 1</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; bitop and  res mon feb wen</span><br><span class="line">(integer) 12500001`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如上例,优点:  </span><br><span class="line">1: 节约空间, 1亿人每天的登陆情况,用1亿bit,约1200WByte,约10M 的字符就能表示  </span><br><span class="line">2: 计算方便   </span><br><span class="line">### 集合 set 相关命令</span><br><span class="line"></span><br><span class="line">**集合的性质: 唯一性,无序性,确定性**</span><br><span class="line"></span><br><span class="line">注: 在string和link的命令中,可以通过range 来访问string中的某几个字符或某几个元素  </span><br><span class="line">但,因为集合的无序性,无法通过下标或范围来访问部分元素. </span><br><span class="line">因此想看元素,要么随机先一个,要么全选</span><br><span class="line"></span><br><span class="line">- sadd key  value1 value2  </span><br><span class="line">作用: 往集合key中增加元素 </span><br><span class="line">- srem value1 value2  </span><br><span class="line">作用: 删除集合中集为 value1 value2的元素  </span><br><span class="line">返回值: 忽略不存在的元素后,真正删除掉的元素的个数</span><br><span class="line">- spop key  </span><br><span class="line">作用: 返回并删除集合中key中1个随机元素  </span><br><span class="line">随机--体现了无序性</span><br><span class="line">- srandmember key  </span><br><span class="line">作用: 返回集合key中,随机的1个元素.  </span><br><span class="line">- sismember key  value  </span><br><span class="line">作用: 判断value是否在key集合中   </span><br><span class="line">是返回1,否返回0 </span><br><span class="line">- smembers key</span><br><span class="line">作用: 返回集中中所有的元素 </span><br><span class="line">- scard key   </span><br><span class="line">作用: 返回集合中元素的个数</span><br><span class="line">- smove source dest value  </span><br><span class="line">作用:把source中的value删除,并添加到dest集合中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- sinter  key1 key2 key3  </span><br><span class="line">作用: 求出key1 key2 key3 三个集合中的交集,并返回</span><br><span class="line">      redis 127.0.0.1:6379&gt; sadd s1 0 2 4 6</span><br><span class="line">      (integer) 4</span><br><span class="line">      redis 127.0.0.1:6379&gt; sadd s2 1 2 3 4</span><br><span class="line">      (integer) 4</span><br><span class="line">      redis 127.0.0.1:6379&gt; sadd s3 4 8 9 12</span><br><span class="line">      (integer) 4</span><br><span class="line">      redis 127.0.0.1:6379&gt; sinter s1 s2 s3</span><br><span class="line">      1) &quot;4&quot;</span><br><span class="line">      redis 127.0.0.1:6379&gt; sinter s3 s1 s2</span><br><span class="line">      1) &quot;4&quot;</span><br><span class="line"></span><br><span class="line">- sinterstore dest key1 key2 key3  </span><br><span class="line">作用: 求出key1 key2 key3 三个集合中的交集,并赋给dest</span><br><span class="line">- suion key1 key2.. Keyn  </span><br><span class="line">作用: 求出key1 key2 keyn的并集,并返回</span><br><span class="line">- sdiff key1 key2 key3   </span><br><span class="line">作用: 求出key1与key2 key3的差集  </span><br><span class="line">即key1-key2-key3 </span><br><span class="line">- order set 有序集合  </span><br><span class="line">`zadd key score1 value1 score2 value2 ..`</span><br><span class="line">##### 添加元素</span><br><span class="line">      redis 127.0.0.1:6379&gt; zadd stu 18 lily 19 hmm 20 lilei 21 lilei</span><br><span class="line">      (integer) 3</span><br><span class="line"></span><br><span class="line">- zrem key value1 value2 ..  </span><br><span class="line">作用: 删除集合中的元素</span><br><span class="line">- zremrangebyscore key min max  </span><br><span class="line">作用: 按照socre来删除元素,删除score在[min,max]之间的  </span><br><span class="line">        redis 127.0.0.1:6379&gt; zremrangebyscore stu 4 10</span><br><span class="line">        (integer) 2</span><br><span class="line">        redis 127.0.0.1:6379&gt; zrange stu 0 -1</span><br><span class="line">        1) &quot;f&quot;</span><br><span class="line"></span><br><span class="line">- zremrangebyrank key start end  </span><br><span class="line">作用: 按排名删除元素,删除名次在[start,end]之间的  </span><br><span class="line">      redis 127.0.0.1:6379&gt; zremrangebyrank stu 0 1</span><br><span class="line">      (integer) 2</span><br><span class="line">      redis 127.0.0.1:6379&gt; zrange stu 0 -1</span><br><span class="line">      1) &quot;c&quot;</span><br><span class="line">      2) &quot;e&quot;</span><br><span class="line">      3) &quot;f&quot;</span><br><span class="line">      4) &quot;g&quot;</span><br><span class="line"></span><br><span class="line">- zrank key member   </span><br><span class="line">查询member的排名(升续 0名开始)</span><br><span class="line"></span><br><span class="line">- zrevrank key memeber  </span><br><span class="line">查询 member的排名(降续 0名开始)</span><br><span class="line"></span><br><span class="line">-  ZRANGE key start stop [WITHSCORES]   </span><br><span class="line">把集合排序后,返回名次[start,stop]的元素  </span><br><span class="line">默认是升续排列   </span><br><span class="line">Withscores 是把score也打印出来</span><br><span class="line"></span><br><span class="line">- zrevrange key start stop  </span><br><span class="line">作用:把集合降序排列,取名字[start,stop]之间的元素</span><br><span class="line"></span><br><span class="line">- zrangebyscore  key min max [withscores] limit offset N  </span><br><span class="line">作用: 集合(升续)排序后,取score在[min,max]内的元素,  </span><br><span class="line">并跳过 offset个, 取出N个  </span><br><span class="line">      redis 127.0.0.1:6379&gt; zadd stu 1 a 3 b 4 c 9 e 12 f 15 g</span><br><span class="line">      (integer) 6</span><br><span class="line">      redis 127.0.0.1:6379&gt; zrangebyscore stu 3 12 limit 1 2 withscores</span><br><span class="line">      1) &quot;c&quot;</span><br><span class="line">      2) &quot;4&quot;</span><br><span class="line">      3) &quot;e&quot;</span><br><span class="line">      4) &quot;9&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- zcard key  </span><br><span class="line">返回元素个数</span><br><span class="line"></span><br><span class="line">- zcount key min max  </span><br><span class="line">返回[min,max] 区间内元素的数量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- zinterstore destination numkeys key1 [key2 ...]    </span><br><span class="line">      [WEIGHTS weight [weight ...]] </span><br><span class="line">      [AGGREGATE SUM|MIN|MAX]  </span><br><span class="line">求key1,key2的交集,key1,key2的权重分别是 weight1,weight2  </span><br><span class="line">聚合方法用: sum |min|max  </span><br><span class="line">聚合的结果,保存在dest集合内</span><br><span class="line"></span><br><span class="line">**注意: weights ,aggregate如何理解?**</span><br><span class="line">答: 如果有交集, 交集元素又有socre,score怎么处理?  </span><br><span class="line"> Aggregate sum-&gt;score相加   , min 求最小score, max 最大score  </span><br><span class="line">另: 可以通过weigth设置不同key的权重, 交集时,socre * weights</span><br><span class="line"></span><br><span class="line">详见下例  </span><br><span class="line">      ```    </span><br><span class="line">      redis 127.0.0.1:6379&gt; zadd z1 2 a 3 b 4 c</span><br><span class="line">          (integer) 3</span><br><span class="line">          redis 127.0.0.1:6379&gt; zadd z2 2.5 a 1 b 8 d</span><br><span class="line">          (integer) 3</span><br><span class="line">          redis 127.0.0.1:6379&gt; zinterstore tmp 2 z1 z2</span><br><span class="line">          (integer) 2</span><br><span class="line">          redis 127.0.0.1:6379&gt; zrange tmp 0 -1</span><br><span class="line">          1) &quot;b&quot;</span><br><span class="line">          2) &quot;a&quot;</span><br><span class="line">          redis 127.0.0.1:6379&gt; zrange tmp 0 -1 withscores</span><br><span class="line">          1) &quot;b&quot;</span><br><span class="line">          2) &quot;4&quot;</span><br><span class="line">          3) &quot;a&quot;</span><br><span class="line">          4) &quot;4.5&quot;</span><br><span class="line">          redis 127.0.0.1:6379&gt; zinterstore tmp 2 z1 z2 aggregate sum</span><br><span class="line">          (integer) 2</span><br><span class="line">          redis 127.0.0.1:6379&gt; zrange tmp 0 -1 withscores</span><br><span class="line">          1) &quot;b&quot;</span><br><span class="line">          2) &quot;4&quot;</span><br><span class="line">          3) &quot;a&quot;</span><br><span class="line">          4) &quot;4.5&quot;</span><br><span class="line">          redis 127.0.0.1:6379&gt; zinterstore tmp 2 z1 z2 aggregate min</span><br><span class="line">          (integer) 2</span><br><span class="line">          redis 127.0.0.1:6379&gt; zrange tmp 0 -1 withscores</span><br><span class="line">          1) &quot;b&quot;</span><br><span class="line">          2) &quot;1&quot;</span><br><span class="line">          3) &quot;a&quot;</span><br><span class="line">          4) &quot;2&quot;</span><br><span class="line">          redis 127.0.0.1:6379&gt; zinterstore tmp 2 z1 z2 weights 1 2</span><br><span class="line">          (integer) 2</span><br><span class="line">          redis 127.0.0.1:6379&gt; zrange tmp 0 -1 withscores</span><br><span class="line">          1) &quot;b&quot;</span><br><span class="line">          2) &quot;5&quot;</span><br><span class="line">          3) &quot;a&quot;</span><br><span class="line">          4) &quot;7&quot;</span><br><span class="line">          </span><br><span class="line">```</span><br><span class="line">`````````</span><br></pre></td></tr></table></figure>
<h3 id="Hash-哈希数据类型相关命令"><a href="#Hash-哈希数据类型相关命令" class="headerlink" title="Hash 哈希数据类型相关命令"></a>Hash 哈希数据类型相关命令</h3><ul>
<li><p>hset key field value<br>作用: 把key中 filed域的值设为value<br>注:如果没有field域,直接添加,如果有,则覆盖原field域的值</p>
</li>
<li><p>hmset key field1 value1 [field2 value2 field3 value3 ……fieldn valuen]<br>作用: 设置field1-&gt;N 个域, 对应的值是value1-&gt;N<br>(对应PHP理解为  $key = array(file1=&gt;value1, field2=&gt;value2 ….fieldN=&gt;valueN))  </p>
</li>
<li><p>hget key field<br>作用: 返回key中field域的值</p>
</li>
<li><p>hmget key field1 field2 fieldN<br>作用: 返回key中field1 field2 fieldN域的值</p>
</li>
<li><p>hgetall key<br>作用:返回key中,所有域与其值</p>
</li>
<li><p>hdel key field<br>作用: 删除key中 field域</p>
</li>
<li><p>hlen key<br>作用: 返回key中元素的数量</p>
</li>
</ul>
<p>hexists key field<br>作用: 判断key中有没有field域</p>
<p>hinrby key field value<br>作用: 是把key中的field域的值增长整型值value</p>
<p>hinrby float  key field value<br>作用: 是把key中的field域的值增长浮点值value</p>
<p>hkeys key<br>作用: 返回key中所有的field</p>
<p>kvals key<br>作用: 返回key中所有的value</p>
<p>Redis 中的事务</p>
<p>Redis支持简单的事务</p>
<p>Redis与 mysql事务的对比</p>
<pre><code>Mysql    Redis
</code></pre><p>开启    start transaction    muitl<br>语句    普通sql    普通命令<br>失败    rollback 回滚    discard 取消<br>成功    commit    exec</p>
<p>注: rollback与discard 的区别<br>如果已经成功执行了2条语句, 第3条语句出错.<br>Rollback后,前2条的语句影响消失.<br>Discard只是结束本次事务,前2条语句造成的影响仍然还在</p>
<p>注:<br>在mutil后面的语句中, 语句出错可能有2种情况<br>1: 语法就有问题,<br>这种,exec时,报错, 所有语句得不到执行</p>
<p>2: 语法本身没错,但适用对象有问题. 比如 zadd 操作list对象<br>Exec之后,会执行正确的语句,并跳过有不适当的语句.</p>
<p>(如果zadd操作list这种事怎么避免? 这一点,由程序员负责)</p>
<p>思考:<br>我正在买票<br>Ticket -1 , money -100<br>而票只有1张, 如果在我multi之后,和exec之前, 票被别人买了—即ticket变成0了.<br>我该如何观察这种情景,并不再提交</p>
<p>悲观的想法:<br>世界充满危险,肯定有人和我抢, 给 ticket上锁, 只有我能操作. [悲观锁]</p>
<p>乐观的想法:<br>没有那么人和我抢,因此,我只需要注意,<br>–有没有人更改ticket的值就可以了 [乐观锁]</p>
<p>Redis的事务中,启用的是乐观锁,只负责监测key没有被改动.</p>
<p>具体的命令—-  watch命令<br>例:<br>redis 127.0.0.1:6379&gt; watch ticket<br>OK<br>redis 127.0.0.1:6379&gt; multi<br>OK<br>redis 127.0.0.1:6379&gt; decr ticket<br>QUEUED<br>redis 127.0.0.1:6379&gt; decrby money 100<br>QUEUED<br>redis 127.0.0.1:6379&gt; exec<br>(nil)   // 返回nil,说明监视的ticket已经改变了,事务就取消了.<br>redis 127.0.0.1:6379&gt; get ticket<br>“0”<br>redis 127.0.0.1:6379&gt; get money<br>“200”</p>
<p>watch key1 key2  … keyN<br>作用:监听key1 key2..keyN有没有变化,如果有变, 则事务取消</p>
<p>unwatch<br>作用: 取消所有watch监听</p>
<p>消息订阅</p>
<p>使用办法:<br>订阅端: Subscribe 频道名称<br>发布端: publish 频道名称 发布内容</p>
<p>客户端例子:<br>redis 127.0.0.1:6379&gt; subscribe news<br>Reading messages… (press Ctrl-C to quit)<br>1) “subscribe”<br>2) “news”<br>3) (integer) 1<br>1) “message”<br>2) “news”<br>3) “good good study”<br>1) “message”<br>2) “news”<br>3) “day day up”</p>
<p>服务端例子:<br>redis 127.0.0.1:6379&gt; publish news ‘good good study’<br>(integer) 1<br>redis 127.0.0.1:6379&gt; publish news ‘day day up’<br>(integer) 1</p>
<p>Redis持久化配置</p>
<p>Redis的持久化有2种方式   1快照  2是日志</p>
<p>Rdb快照的配置选项</p>
<p>save 900 1      // 900内,有1条写入,则产生快照<br>save 300 1000   // 如果300秒内有1000次写入,则产生快照<br>save 60 10000  // 如果60秒内有10000次写入,则产生快照<br>(这3个选项都屏蔽,则rdb禁用)</p>
<p>stop-writes-on-bgsave-error yes  // 后台备份进程出错时,主进程停不停止写入?<br>rdbcompression yes    // 导出的rdb文件是否压缩<br>Rdbchecksum   yes //  导入rbd恢复时数据时,要不要检验rdb的完整性<br>dbfilename dump.rdb  //导出来的rdb文件名<br>dir ./  //rdb的放置路径</p>
<p>Aof 的配置<br>appendonly no # 是否打开 aof日志功能</p>
<p>appendfsync always   # 每1个命令,都立即同步到aof. 安全,速度慢<br>appendfsync everysec # 折衷方案,每秒写1次<br>appendfsync no      # 写入工作交给操作系统,由操作系统判断缓冲区大小,统一写入到aof. 同步频率低,速度快,</p>
<p>no-appendfsync-on-rewrite  yes: # 正在导出rdb快照的过程中,要不要停止同步aof<br>auto-aof-rewrite-percentage 100 #aof文件大小比起上次重写时的大小,增长率100%时,重写<br>auto-aof-rewrite-min-size 64mb #aof文件,至少超过64M时,重写</p>
<p>注: 在dump rdb过程中,aof如果停止同步,会不会丢失?<br>答: 不会,所有的操作缓存在内存的队列里, dump完成后,统一操作.</p>
<p>注: aof重写是指什么?<br>答: aof重写是指把内存中的数据,逆化成命令,写入到.aof日志里.<br>以解决 aof日志过大的问题.</p>
<p>问: 如果rdb文件,和aof文件都存在,优先用谁来恢复数据?<br>答: aof</p>
<p>问: 2种是否可以同时用?<br>答: 可以,而且推荐这么做</p>
<p>问: 恢复时rdb和aof哪个恢复的快<br>答: rdb快,因为其是数据的内存映射,直接载入到内存,而aof是命令,需要逐条执行<br>redis 服务器端命令<br>redis 127.0.0.1:6380&gt; time  ,显示服务器时间 , 时间戳(秒), 微秒数<br>1) “1375270361”<br>2) “504511”</p>
<p>redis 127.0.0.1:6380&gt; dbsize  // 当前数据库的key的数量<br>(integer) 2<br>redis 127.0.0.1:6380&gt; select 2<br>OK<br>redis 127.0.0.1:6380[2]&gt; dbsize<br>(integer) 0<br>redis 127.0.0.1:6380[2]&gt; </p>
<p>BGREWRITEAOF 后台进程重写AOF<br>BGSAVE       后台保存rdb快照<br>SAVE         保存rdb快照<br>LASTSAVE     上次保存时间</p>
<p>Slaveof master-Host port  , 把当前实例设为master的slave</p>
<p>Flushall  清空所有库所有键<br>Flushdb  清空当前库所有键<br>Showdown [save/nosave]</p>
<p>注: 如果不小心运行了flushall, 立即 shutdown nosave ,关闭服务器<br>然后 手工编辑aof文件, 去掉文件中的 “flushall ”相关行, 然后开启服务器,就可以导入回原来数据.</p>
<p>如果,flushall之后,系统恰好bgrewriteaof了,那么aof就清空了,数据丢失.</p>
<p>Slowlog 显示慢查询<br>注:多慢才叫慢?<br>答: 由slowlog-log-slower-than 10000 ,来指定,(单位是微秒)</p>
<p>服务器储存多少条慢查询的记录?<br>答: 由 slowlog-max-len 128 ,来做限制</p>
<p>Info [Replication/CPU/Memory..]<br>查看redis服务器的信息</p>
<p>Config get 配置项<br>Config set 配置项 值 (特殊的选项,不允许用此命令设置,如slave-of, 需要用单独的slaveof命令来设置)</p>
<p>Redis运维时需要注意的参数<br>1: 内存</p>
<h1 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h1><p>used_memory:859192 数据结构的空间<br>used_memory_rss:7634944 实占空间<br>mem_fragmentation_ratio:8.89 前2者的比例,1.N为佳,如果此值过大,说明redis的内存的碎片化严重,可以导出再导入一次.<br>2: 主从复制</p>
<h1 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h1><p>role:slave<br>master_host:192.168.1.128<br>master_port:6379<br>master_link_status:up</p>
<p>3:持久化</p>
<h1 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h1><p>rdb_changes_since_last_save:0<br>rdb_last_save_time:1375224063</p>
<p>4: fork耗时</p>
<p>#Status<br>latest_fork_usec:936  上次导出rdb快照,持久化花费微秒<br>注意: 如果某实例有10G内容,导出需要2分钟,<br>每分钟写入10000次,导致不断的rdb导出,磁盘始处于高IO状态.</p>
<p>5: 慢日志<br>config get/set slowlog-log-slower-than<br>CONFIG get/SET slowlog-max-len<br>slowlog get N 获取慢日志</p>
<p>运行时更改master-slave<br>修改一台slave(设为A)为new master<br>1) 命令该服务不做其他redis服务的slave<br>   命令: slaveof no one<br>2) 修改其readonly为yes</p>
<p>其他的slave再指向new master A<br>1) 命令该服务为new master A的slave<br>   命令格式 slaveof IP port<br>监控工具 sentinel</p>
<p>Sentinel不断与master通信,获取master的slave信息.<br>监听master与slave的状态<br>如果某slave失效,直接通知master去除该slave.</p>
<p>如果master失效,,是按照slave优先级(可配置), 选取1个slave做 new master<br>,把其他slave–&gt; new master</p>
<p>疑问: sentinel与master通信,如果某次因为master IO操作频繁,导致超时,<br>此时,认为master失效,很武断.<br>解决: sentnel允许多个实例看守1个master, 当N台(N可设置)sentinel都认为master失效,才正式失效.</p>
<p>Sentinel选项配置<br>port 26379 # 端口<br>sentinel monitor mymaster 127.0.0.1 6379 2 ,<br>给主机起的名字(不重即可),<br>当2个sentinel实例都认为master失效时,正式失效</p>
<p>sentinel down-after-milliseconds mymaster 30000  多少毫秒后连接不到master认为断开<br>sentinel can-failover mymaster yes #是否允许sentinel修改slave-&gt;master. 如为no,则只能监控,无权修改./<br>sentinel parallel-syncs mymaster 1 , 一次性修改几个slave指向新的new master.<br>sentinel client-reconfig-script mymaster /var/redis/reconfig.sh ,# 在重新配置new master,new slave过程,可以触发的脚本<br>redis 与关系型数据库的适合场景</p>
<p>书签系统<br>create table book (<br>bookid int,<br>title char(20)<br>)engine myisam charset utf8;</p>
<p>insert into book values<br>(5 , ‘PHP圣经’),<br>(6 , ‘ruby实战’),<br>(7 , ‘mysql运维’)<br>(8, ‘ruby服务端编程’);</p>
<p>create table tags (<br>tid int,<br>bookid int,<br>content char(20)<br>)engine myisam charset utf8;</p>
<p>insert into tags values<br>(10 , 5 , ‘PHP’),<br>(11 , 5 , ‘WEB’),<br>(12 , 6 , ‘WEB’),<br>(13 , 6 , ‘ruby’),<br>(14 , 7 , ‘database’),<br>(15 , 8 , ‘ruby’),<br>(16 , 8 , ‘server’);</p>
<h1 id="既有web标签-又有PHP-同时还标签的书-要用连接查询"><a href="#既有web标签-又有PHP-同时还标签的书-要用连接查询" class="headerlink" title="既有web标签,又有PHP,同时还标签的书,要用连接查询"></a>既有web标签,又有PHP,同时还标签的书,要用连接查询</h1><p>select * from tags inner join tags as t on tags.bookid=t.bookid<br>where tags.content=’PHP’ and t.content=’WEB’;</p>
<p>换成key-value存储<br>用kv 来存储<br>set book:5:title ‘PHP圣经’<br>set book:6:title ‘ruby实战’<br>set book:7:title ‘mysql运难’<br>set book:8:title ‘ruby server’</p>
<p>sadd tag:PHP 5<br>sadd tag:WEB 5 6<br>sadd tag:database 7<br>sadd tag:ruby 6 8<br>sadd tag:SERVER 8</p>
<p>查: 既有PHP,又有WEB的书<br>Sinter tag:PHP tag:WEB  #查集合的交集</p>
<p>查: 有PHP或有WEB标签的书<br>Sunin tag:PHP tag:WEB</p>
<p>查:含有ruby,不含WEB标签的书<br>Sdiff tag:ruby tag:WEB #求差集</p>
<p>Redis key 设计技巧</p>
<p>1: 把表名转换为key前缀 如, tag:<br>2: 第2段放置用于区分区key的字段–对应mysql中的主键的列名,如userid<br>3: 第3段放置主键值,如2,3,4…., a , b ,c<br>4: 第4段,写要存储的列名</p>
<p>用户表 user  , 转换为key-value存储<br>userid    username    passworde    email<br>9    Lisi    1111111    <a href="mailto:lisi@163.com" target="_blank" rel="noopener">lisi@163.com</a></p>
<p>set  user:userid:9:username lisi<br>set  user:userid:9:password 111111<br>set  user:userid:9:email   <a href="mailto:lisi@163.com" target="_blank" rel="noopener">lisi@163.com</a></p>
<p>keys user:userid:9*</p>
<p>2 注意:<br>在关系型数据中,除主键外,还有可能其他列也步骤查询,<br>如上表中, username 也是极频繁查询的,往往这种列也是加了索引的.</p>
<p>转换到k-v数据中,则也要相应的生成一条按照该列为主的key-value<br>Set  user:username:lisi:uid  9  </p>
<p>这样,我们可以根据username:lisi:uid ,查出userid=9,<br>再查user:9:password/email …</p>
<p>完成了根据用户名来查询用户信息<br>php-redis扩展编译</p>
<p>1: 到pecl.php.net  搜索redis<br>2: 下载stable版(稳定版)扩展<br>3: 解压,<br>4: 执行/php/path/bin/phpize (作用是检测PHP的内核版本,并为扩展生成相应的编译配置)<br>5: configure –with-php-config=/php/path/bin/php-config<br>6: make &amp;&amp; make install</p>
<p>引入编译出的redis.so插件<br>1: 编辑php.ini<br>2: 添加</p>
<p>redis插件的使用<br>// get instance<br>$redis = new Redis();</p>
<p>// connect to redis server<br>$redis-&gt;open(‘localhost’,6380);<br>$redis-&gt;set(‘user:userid:9:username’,’wangwu’);<br>var_dump($redis-&gt;get(‘user:userid:9:username’));</p>
<p>微博项目的key设计<br>全局相关的key:<br>表名    global<br>列名    操作    备注<br>Global:userid    incr    产生全局的userid<br>Global:postid    Incr    产生全局的postid</p>
<p>用户相关的key(表)<br>表名    user<br>Userid    Username    Password    Authsecret<br>3    Test3    1111111    #U*Q(%_</p>
<p>在redis中,变成以下几个key<br>Key前缀    user<br>User:Userid:<em>    User:userid:</em>Username    User:userid:<em>Password    User:userid:</em>:Authsecret<br>User:userid:3    User:userid:3:Test3    User:userid:3:1111111    User:userid:3:#U*Q(%_</p>
<p>微博相关的表设计<br>表名    post<br>Postid    Userid    Username    Time     Content<br>4    2    Lisi    1370987654f    测试内容</p>
<p>微博在redis中,与表设计对应的key设计<br>Key前缀    post<br>Post:Postid:<em>    Post:postid:</em>Userid    Post:postid:<em>:Username    Post:postid:</em>:Time     Post:postid:*:Content<br>4    2    Lisi    1370987654f    测试内容</p>
<p>关注表: following<br>Following:$userid –&gt;</p>
<p>粉丝表<br>Follower:$userid —&gt;</p>
<p>推送表:revicepost</p>
<p>3    4    7            </p>
<p>=================拉模型,改进=====================</p>
<p>拉取表</p>
<p>3    4    7            </p>
<p>问: 上次我拉取了 A-&gt;5,67,三条微博, 下次刷新home.php, 从&gt;7的微博开始拉取<br>解决: 拉取时,设定一个lastpull时间点, 下次拉取时,取&gt;lastpull的微博</p>
<p>问: 有很多关注人,如何取?<br>解决: 循环自己的关注列表,逐个取他们的新微博</p>
<p>问: 取出来之后放在哪儿?<br>答: pull:$userid的链接里</p>
<p>问: 如果个人中心,只有前1000条<br>答: ltrim,只取前1000条</p>
<p>问: 如果我关注 A,B两人, 从2人中,各取3条最新信息<br>,这3+3条信息, 从时间上,是交错的, 如何按时间排序?<br>答: 我们发布时, 是发布的hash结构, 不能按时间来排序.</p>
<p>解决:  同步时,取微博后,记录本次取的微博的最大id,<br>下次同步时,只取比最大id更大的微博</p>
<p>Time taken for tests:   32.690 seconds<br>Complete requests:      20000<br>Failed requests:        0<br>Write errors:           0<br>Non-2xx responses:      20000<br>Total transferred:      13520000 bytes<br>Total POSTed:           5340000<br>HTML transferred:       9300000 bytes<br>Requests per second:    611.80 [#/sec] (mean)<br>Time per request:       81.726 [ms] (mean)<br>Time per request:       1.635 [ms] (mean, across all concurrent requests)<br>Transfer rate:          403.88 [Kbytes/sec] received<br>                        159.52 kb/s sent<br>                        563.41 kb/s total</p>
<p>Connection Times (ms)<br>              min  mean[+/-sd] median   max<br>Connect:        0    0   0.9      0      19<br>Processing:    14   82   8.4     81     153<br>Waiting:        4   82   8.4     80     153<br>Total:         20   82   8.2     81     153</p>
<p>Percentage of the requests served within a certain time (ms)<br>  50%     81<br>  66%     84<br>  75%     86<br>  80%     88<br>  90%     93<br>  95%     96<br>  98%    100<br>  99%    103<br> 100%    153 (longest request)</p>
<p>测试结果:<br>50个并发, 20000次请求, 虚拟下,未做特殊优化<br>每次请求redis写操作6次.<br>30+秒左右完成.</p>
<p>平均每秒发布700条微博, 4000次redis写入.<br>后台定时任务,回归冷数据入mysql<br>Redis配置文件<br> daemonize yes  # redis是否以后台进程运行<br> Requirepass  密码 # 配置redis连接的密码<br>注:配置密码后,客户端连上服务器,需要先执行授权命令</p>
<h1 id="auth-密码"><a href="#auth-密码" class="headerlink" title="auth 密码"></a>auth 密码</h1>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/12/27/docker-容器/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">docker 容器</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="redis-学习" data-title="redis 学习" data-url="https://dayu007.github.io/2018/12/27/redis-学习/" data-images="https://liuyiyi.site/head.jpg" data-content="redis 学习">
    <div class="ds-share-inline">
      <ul class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2018 dayu007
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>